{
  "hash": "0c1c6e920524363998a9ff5ce12897b2",
  "result": {
    "markdown": "---\ntitle: \"My Document\"\nexecute:\n  code-fold: true\n  echo: false\n  warning: false\n---\n\n\n# Country\n\nIn this section I will try to look at the `medium_country` data from a level higher - aggregated per country. I would like to see first a high-level intro to the data, see which countries drive the most users and revenue, try to identify a subset on which I can focus the analysis and lastly - try to give an advise to our client by just looking at this level.\n\n\n::: {.cell}\n\n:::\n\n\nThe source file contains data on 240 in total and e.g. looks like this for Croatia\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div class=\"datatables html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-366e6cb9c3eec2bc3f22\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-366e6cb9c3eec2bc3f22\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"10\",\"11\",\"12\",\"13\",\"14\",\"15\",\"16\",\"17\",\"18\",\"19\",\"20\",\"21\",\"22\",\"23\",\"24\",\"25\",\"26\",\"27\",\"28\"],[\"referral\",\"(none)\",\"cpc\",\"organic\",\"email\",\"(not set)\",\"website\",\"Social\",\"s-cpm\",\"paid-social\",\"tram\",\"navbar\",\"social\",\"display\",\"mobile-notification\",\"button\",\"ads\",\"paidpromo\",\"cpc,cpc\",\"affiliate\",\"peoplebasedmarketing\",\"test\",\"twitter\",\"banner\",\"blablaba\",\"feed\",\"sms\",\"social-media\"],[\"Croatia\",\"Croatia\",\"Croatia\",\"Croatia\",\"Croatia\",\"Croatia\",\"Croatia\",\"Croatia\",\"Croatia\",\"Croatia\",\"Croatia\",\"Croatia\",\"Croatia\",\"Croatia\",\"Croatia\",\"Croatia\",\"Croatia\",\"Croatia\",\"Croatia\",\"Croatia\",\"Croatia\",\"Croatia\",\"Croatia\",\"Croatia\",\"Croatia\",\"Croatia\",\"Croatia\",\"Croatia\"],[14334,20591,12427,6484,1041,1082,35,124,3718,312,281,113,18,16,16,13,12,8,3,2,2,2,2,1,1,1,1,1],[12080,19026,10985,3479,491,755,1,81,3409,311,138,0,15,9,13,6,7,8,0,0,2,0,0,1,0,0,1,1],[21717,29102,18319,13172,2624,2290,84,190,4546,369,753,237,31,20,43,38,21,10,6,4,2,3,4,1,1,3,1,1],[0.5078049454,0.362861659,0.3546590971,0.2096872153,0.4832317073,0.05982532751,0.3571428571,0.7789473684,0.8587769468000001,0.9132791327999999,0.6268260292,0.4219409283,0.7419354839,0.75,0.511627907,0.3157894737,0.5238095238,0.9,0.3333333333,0.25,0.5,0.3333333333,1,1,0,0.3333333333,1,1],[2.362527053,4.830046045,5.012173154,5.714773763,2.941310976,0.6131004367,6.333333333,2.189473684,1.349318082,1.162601626,2.227091633,4.396624473,1.677419355,1.3,4.11627907,6.289473684,2.428571429,1.4,1.666666667,5.5,7,2,1,1,2,5.666666667,1,1],[212.450891,216.0374201,174.4474043,352.7511388,199.4885671,154.3393013,514.5714286,181.7421053,40.84139903,10.94850949,161.6321381,300.0759494,66.5483871,13.55,315.6046512,117.9210526,112.2857143,62.7,337,550.25,208,200,0,0,31,920,0,0],[0.0462771101,0.02848601471,0.009771275725,0.009034315213999999,0.006097560976,0.007423580786,0.0119047619,0.01052631579,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1005,829,179,119,16,17,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[324880.2716,179449.3319,46168.26303,33227.75358,5558.73,4158.27,301,95.33,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>medium<\\/th>\\n      <th>country<\\/th>\\n      <th>users<\\/th>\\n      <th>new_users<\\/th>\\n      <th>sessions<\\/th>\\n      <th>bounce_rate<\\/th>\\n      <th>pages_session<\\/th>\\n      <th>avg_session_duration<\\/th>\\n      <th>ecommerce_conversion_rate<\\/th>\\n      <th>transactions<\\/th>\\n      <th>revenue<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[3,4,5,6,7,8,9,10,11]},{\"orderable\":false,\"targets\":0}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\nThe data is on country / medium level so I would like to collapse it down to just the country level grouping first and compute some additional high-level metrics.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"medium\"                    \"country\"                  \n [3] \"users\"                     \"new_users\"                \n [5] \"sessions\"                  \"bounce_rate\"              \n [7] \"pages_session\"             \"avg_session_duration\"     \n [9] \"ecommerce_conversion_rate\" \"transactions\"             \n[11] \"revenue\"                  \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nby_country <- \n  medium_country_raw |> \n  group_by(country) |> \n  summarise(\n    # summable-metrics\n    across(\n      c(users, new_users, sessions, transactions, revenue),\n      sum\n    ),\n    # take medians for the rates, shares, durations\n    across(\n      c(bounce_rate, pages_session, avg_session_duration, ecommerce_conversion_rate),\n      median\n    )\n  ) |> \n  ungroup() |> \n  # calculate new columns\n  mutate(\n    revenue_per_transaction = revenue / transactions,\n    new_users_share = new_users / users\n  )\n\nby_country |> filter(country == \"Croatia\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 12\n  country users new_users sessions transactions revenue bounce_rate\n  <chr>   <dbl>     <dbl>    <dbl>        <dbl>   <dbl>       <dbl>\n1 Croatia 60641     50819    93592         2168 593839.       0.504\n# ℹ 5 more variables: pages_session <dbl>, avg_session_duration <dbl>,\n#   ecommerce_conversion_rate <dbl>, revenue_per_transaction <dbl>,\n#   new_users_share <dbl>\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/htmlwidgets-1.6.2/htmlwidgets.js\"></script>\n<link href=\"site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/datatables-binding-0.28/datatables.js\"></script>\n<script src=\"site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"site_libs/dt-core-1.13.4/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"site_libs/dt-core-1.13.4/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/dt-core-1.13.4/js/jquery.dataTables.min.js\"></script>\n<link href=\"site_libs/crosstalk-1.2.0/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/crosstalk-1.2.0/js/crosstalk.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}